/*! For license information please see background.js.LICENSE.txt */
(()=>{function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}function n(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=e(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){c=!0,i=t},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw i}}}}function e(t,n){if(t){if("string"==typeof t)return r(t,n);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,n):void 0}}function r(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function o(){"use strict";o=function(){return e};var n,e={},r=Object.prototype,a=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(t,n,e,r){return Object.defineProperty(t,n,{value:e,enumerable:!r,configurable:!r,writable:!r})}try{l({},"")}catch(n){l=function(t,n,e){return t[n]=e}}function p(t,e,r,o){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype);return l(i,"_invoke",function(t,e,r){var o=1;return function(a,i){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===a)throw i;return{value:n,done:!0}}for(r.method=a,r.arg=i;;){var s=r.delegate;if(s){var c=k(s,r);if(c){if(c===h)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(1===o)throw o=4,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=3;var u=f(t,e,r);if("normal"===u.type){if(o=r.done?4:2,u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=4,r.method="throw",r.arg=u.arg)}}}(t,r,new C(o||[])),!0),i}function f(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}e.wrap=p;var h={};function g(){}function d(){}function m(){}var y={};l(y,s,(function(){return this}));var v=Object.getPrototypeOf,b=v&&v(v(S([])));b&&b!==r&&a.call(b,s)&&(y=b);var w=m.prototype=g.prototype=Object.create(y);function _(t){["next","throw","return"].forEach((function(n){l(t,n,(function(t){return this._invoke(n,t)}))}))}function x(n,e){function r(o,i,s,c){var u=f(n[o],n,i);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==t(p)&&a.call(p,"__await")?e.resolve(p.__await).then((function(t){r("next",t,s,c)}),(function(t){r("throw",t,s,c)})):e.resolve(p).then((function(t){l.value=t,s(l)}),(function(t){return r("throw",t,s,c)}))}c(u.arg)}var o;l(this,"_invoke",(function(t,n){function a(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(a,a):a()}),!0)}function k(t,e){var r=e.method,o=t.i[r];if(o===n)return e.delegate=null,"throw"===r&&t.i.return&&(e.method="return",e.arg=n,k(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var a=f(o,t.i,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,h;var i=a.arg;return i?i.done?(e[t.r]=i.value,e.next=t.n,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,h):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function z(t){this.tryEntries.push(t)}function E(t){var e=t[4]||{};e.type="normal",e.arg=n,t[4]=e}function C(t){this.tryEntries=[[-1]],t.forEach(z,this),this.reset(!0)}function S(e){if(null!=e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(a.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=n,t.done=!0,t};return i.next=i}}throw new TypeError(t(e)+" is not iterable")}return d.prototype=m,l(w,"constructor",m),l(m,"constructor",d),d.displayName=l(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===d||"GeneratorFunction"===(n.displayName||n.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,u,"GeneratorFunction")),t.prototype=Object.create(w),t},e.awrap=function(t){return{__await:t}},_(x.prototype),l(x.prototype,c,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,o,a){void 0===a&&(a=Promise);var i=new x(p(t,n,r,o),a);return e.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},_(w),l(w,u,"Generator"),l(w,s,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var n=Object(t),e=[];for(var r in n)e.unshift(r);return function t(){for(;e.length;)if((r=e.pop())in n)return t.value=r,t.done=!1,t;return t.done=!0,t}},e.values=S,C.prototype={constructor:C,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n){i.type="throw",i.arg=t,e.next=n}for(var o=e.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a[4],s=this.prev,c=a[1],u=a[2];if(-1===a[0])return r("end"),!1;if(!c&&!u)throw Error("try statement without catch or finally");if(null!=a[0]&&a[0]<=s){if(s<c)return this.method="next",this.arg=n,r(c),!0;if(s<u)return r(u),!1}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]>-1&&r[0]<=this.prev&&this.prev<r[2]){var o=r;break}}o&&("break"===t||"continue"===t)&&o[0]<=n&&n<=o[2]&&(o=null);var a=o?o[4]:{};return a.type=t,a.arg=n,o?(this.method="next",this.next=o[2],h):this.complete(a)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),h},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e[2]===t)return this.complete(e[4],e[3]),E(e),h}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e[0]===t){var r=e[4];if("throw"===r.type){var o=r.arg;E(e)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={i:S(t),r:e,n:r},"next"===this.method&&(this.arg=n),h}},e}function a(t,n,e,r,o,a,i){try{var s=t[a](i),c=s.value}catch(t){return void e(t)}s.done?n(c):Promise.resolve(c).then(r,o)}function i(t){return function(){var n=this,e=arguments;return new Promise((function(r,o){var i=t.apply(n,e);function s(t){a(i,r,o,s,c,"next",t)}function c(t){a(i,r,o,s,c,"throw",t)}s(void 0)}))}}function s(t){return t?t.replace(/\b(Inc|Ltd|Corp|Corporation|LLC|Limited|Company|Co|Entertainment|Interactive)\.?\b/gi,"").trim():""}function c(t,n){var e=t.toLowerCase(),r=n.toLowerCase();if(e===r)return 100;var o=0;(e.includes(r)||r.includes(e))&&(o+=50);var a=e.split(/\s+/).filter((function(t){return t.length>1})),i=r.split(/\s+/).filter((function(t){return t.length>1}));return o+=10*a.filter((function(t){return i.includes(t)})).length,o-=.5*Math.abs(e.length-r.length),Math.max(0,o)}function u(t){var n=s(t).toLowerCase().replace(/\s+/g,"");return(n=n.replace(/[^a-z0-9.]/g,"")).includes(".")||(n+=".com"),n}var l="RkAYDXn_fooT15v42PkAwg";function p(t){return f.apply(this,arguments)}function f(){return(f=i(o().mark((function t(n){var e,r,a,i,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return",null);case 2:return e="https://api.apollo.io/api/v1/organizations/enrich?domain=".concat(n),t.prev=3,console.log("Apollo API: Enriching organization by domain:",n),t.next=7,fetch(e,{method:"GET",headers:{"Cache-Control":"no-cache","Content-Type":"application/json","X-Api-Key":l}});case 7:return r=t.sent,t.next=10,r.json();case 10:if(a=t.sent,console.log("Apollo API: Org enrichment response:",JSON.stringify(a,null,2)),r.ok&&a.organization){t.next=14;break}throw new Error("HTTP error! status: ".concat(r.status," - ").concat(JSON.stringify(a)));case 14:if((i=a.organization)&&!i.domain&&i.website_url)try{s=new URL(i.website_url),i.domain=s.hostname,i.domain.startsWith("www.")&&(i.domain=i.domain.substring(4))}catch(t){console.warn("Could not parse domain from website_url for enriched org:",i.name,"URL:",i.website_url,t)}return t.abrupt("return",i);case 19:return t.prev=19,t.t0=t.catch(3),console.error("Error enriching organization by domain:",t.t0),t.abrupt("return",null);case 23:case"end":return t.stop()}}),t,null,[[3,19]])})))).apply(this,arguments)}function h(t){return g.apply(this,arguments)}function g(){return g=i(o().mark((function t(n){var e,r,a,i,s,c=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:[],a={q_organization_name:n,page:1,per_page:50},(e=c.length>1&&void 0!==c[1]?c[1]:[]).length>0&&(a.organization_locations=e),r.length>0&&(a.q_organization_keyword_tags=r),t.prev=6,console.log("Apollo API: Searching for organization:",n,"Locations:",e,"Keywords:",r),t.next=10,fetch("https://api.apollo.io/api/v1/mixed_companies/search",{method:"POST",headers:{"Content-Type":"application/json","Cache-Control":"no-cache","X-Api-Key":l},body:JSON.stringify(a)});case 10:return i=t.sent,t.next=13,i.json();case 13:if(s=t.sent,console.log("Apollo API: Full org search response:",JSON.stringify(s,null,2)),i.ok){t.next=17;break}throw new Error("HTTP error! status: ".concat(i.status," - ").concat(JSON.stringify(s)));case 17:return t.abrupt("return",s.organizations||s.accounts||s.companies||[]);case 20:return t.prev=20,t.t0=t.catch(6),console.error("Error searching organization on Apollo:",t.t0),t.abrupt("return",[]);case 24:case"end":return t.stop()}}),t,null,[[6,20]])}))),g.apply(this,arguments)}function d(t){return m.apply(this,arguments)}function m(){return m=i(o().mark((function t(a){var i,l,p,f,g,d,m,y,v,b,w,_,x,k,z,E,C,S,A,L,O,T,P,j,I=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=I.length>1&&void 0!==I[1]?I[1]:[],l=I.length>2&&void 0!==I[2]?I[2]:[],(p=new Set).add(a),p.add(s(a)),(f=a.split(" ")).length>0&&p.add(f[0]),f.length>2&&(g=f.slice(0,f.length-1).join(" ").replace(/(Inc|Ltd|Corp|Corporation|LLC|Limited|Company|Co|Entertainment|Interactive|Canada)\.?/gi,"").trim())&&g!==a&&p.add(g),(d=a.replace(/\sCanada\s*(Inc|Ltd|Corp|Corporation|LLC|Limited|Company|Co|Entertainment|Interactive)?\b/gi,"").trim())&&d!==a&&p.add(d),m=[],y=0,v=Array.from(p);case 12:if(!(y<v.length)){t.next=24;break}if(b=v[y]){t.next=16;break}return t.abrupt("continue",21);case 16:return console.log('Apollo API: Trying organization name query: "'.concat(b,'"')),t.next=19,h(b,i,l);case 19:(w=t.sent)&&w.length>0&&m.push.apply(m,function(t){if(Array.isArray(t))return r(t)}(o=w)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(o)||e(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());case 21:y++,t.next=12;break;case 24:if(_=null,x=-1,k=a.toLowerCase(),!(z=u(a))){t.next=47;break}E=n(m),t.prev=30,E.s();case 32:if((C=E.n()).done){t.next=39;break}if(!(S=C.value).primary_domain||S.primary_domain.toLowerCase()!==z){t.next=37;break}return console.log('Found exact domain match for "'.concat(a,'": "').concat(S.name,'" -> "').concat(S.primary_domain,'"')),t.abrupt("return",S);case 37:t.next=32;break;case 39:t.next=44;break;case 41:t.prev=41,t.t0=t.catch(30),E.e(t.t0);case 44:return t.prev=44,E.f(),t.finish(44);case 47:A=0,L=m;case 48:if(!(A<L.length)){t.next=59;break}if((O=L[A]).name){t.next=52;break}return t.abrupt("continue",56);case 52:T=O.name.toLowerCase(),P=c(k,T),O.website_url&&O.primary_domain&&(P+=20),P>x&&(x=P,_=O);case 56:A++,t.next=48;break;case 59:if(_){if(_.website_url)try{j=new URL(_.website_url),_.domain=j.hostname,_.domain.startsWith("www.")&&(_.domain=_.domain.substring(4)),console.log("Extracted domain from website_url for selected best match org:",_.name,"->",_.domain)}catch(t){console.warn("Could not parse domain from website_url for org:",_.name,"URL:",_.website_url,t)}console.log('Found best match for "'.concat(a,'": "').concat(_.name,'" with score ').concat(x))}else console.warn('No strong match found for "'.concat(a,'" among Apollo results.'));return t.abrupt("return",_);case 61:case"end":return t.stop()}var o}),t,null,[[30,41,44,47]])}))),m.apply(this,arguments)}function y(t){return v.apply(this,arguments)}function v(){return(v=i(o().mark((function t(n){var e,r,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={},n.organization&&(n.organization.domain&&(e.q_organization_domains_list=[n.organization.domain]),n.organization.id&&(e.organization_ids=[n.organization.id]),n.organization.name&&(e.q_organization_names=[n.organization.name])),n.personTitles&&n.personTitles.length>0&&(e.person_titles=n.personTitles,e.include_similar_titles=!0),n.personSeniorities&&n.personSeniorities.length>0&&(e.person_seniorities=n.personSeniorities),n.organizationLocations&&n.organizationLocations.length>0&&(e.organization_locations=n.organizationLocations),n.personLocations&&n.personLocations.length>0&&(e.person_locations=n.personLocations),n.q_keywords&&(e.q_keywords=n.q_keywords),n.contact_email_status&&n.contact_email_status.length>0&&(e.contact_email_status=n.contact_email_status),n.organization_num_employees_ranges&&n.organization_num_employees_ranges.length>0&&(e.organization_num_employees_ranges=n.organization_num_employees_ranges),e.page=n.page||1,e.per_page=n.per_page||25,t.prev=12,console.log("Apollo API: Calling mixed_people/search with body:",e),t.next=16,fetch("https://api.apollo.io/api/v1/mixed_people/search",{method:"POST",headers:{"Content-Type":"application/json","Cache-Control":"no-cache","X-Api-Key":l},body:JSON.stringify(e)});case 16:return r=t.sent,t.next=19,r.json();case 19:if(a=t.sent,console.log("Apollo API: mixed_people/search response:",JSON.stringify(a,null,2)),r.ok){t.next=23;break}throw new Error("HTTP error! status: ".concat(r.status," - ").concat(JSON.stringify(a)));case 23:return t.abrupt("return",a.people||[]);case 26:return t.prev=26,t.t0=t.catch(12),console.error("Error searching people on Apollo:",t.t0),t.abrupt("return",[]);case 30:case"end":return t.stop()}}),t,null,[[12,26]])})))).apply(this,arguments)}chrome.runtime.onMessage.addListener((function(t,n,e){if("findRelevantConnections"===t.action)return i(o().mark((function n(){var r,a,i,s;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,r=t.query.organization_name,console.log("Trying org names:",r),a=null,!(i=u(r))){n.next=10;break}return n.next=8,p(i);case 8:(a=n.sent)&&console.log("Successfully found organization via domain enrichment: ".concat(a.name," -> ").concat(a.domain));case 10:if(a){n.next=15;break}return console.log("Falling back to name-based organization search."),n.next=14,d(r,t.query.organization_locations,t.query.q_organization_keyword_tags);case 14:a=n.sent;case 15:if(console.log("Organization result:",a),a){n.next=19;break}return e({error:"Organization not found. Please try editing the organization name and scan again."}),n.abrupt("return");case 19:return n.next=21,y({organization:a,personSeniorities:t.query.person_seniorities,personTitles:t.query.title});case 21:s=n.sent,console.log("People result:",s),e({organization:a,people:s}),n.next=30;break;case 26:n.prev=26,n.t0=n.catch(0),console.error("Error in background script:",n.t0),e({error:n.t0.message});case 30:case"end":return n.stop()}}),n,null,[[0,26]])})))(),!0}))})();